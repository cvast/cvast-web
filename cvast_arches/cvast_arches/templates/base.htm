<!--
ARCHES - a program developed to inventory and manage immovable cultural heritage.
Copyright (C) 2013 J. Paul Getty Trust and World Monuments Fund

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as
published by the Free Software Foundation, either version 3 of the
License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with this program. If not, see <http://www.gnu.org/licenses/>.
-->

{% load staticfiles %}
{% load i18n %}
<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8"> <![endif]-->  
<!--[if IE 9]> <html lang="en" class="ie9"> <![endif]-->  
<!--[if !IE]><!--> <html lang="en"> <!--<![endif]-->  
{% if debug %}
<script>
    document.write('<script src="https://' + (location.host || 'localhost').split(':')[0] + ':{{ livereload_port }}/livereload.js?snipver=1"></' + 'script>')
</script>
{% endif %}

<head>
    <title>{% block title %}{{ APP_NAME }}{% endblock %}</title>

    <!-- Browser tab icon -->
    <link rel="icon" type="image/png" href="{% static 'img/CVAST_siteLogo_favicon_32x32.png' %}" sizes="16x16">
    <link rel="icon" type="image/png" href="{% static 'img/CVAST_siteLogo_favicon_16x16.png' %}" sizes="32x32">

    <!-- Meta -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Center for Virtualization and Applied Spatial Technologies. CVAST works to document,
                    preserve, and protect the worldâ€™s cultural and natural heritage.">
    <meta name="author" content="CVAST">

	{% block css %}
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.1.0/css/bootstrap.min.css">
        <link rel="stylesheet" href="{% static 'plugins/line-icons/line-icons.css' %}">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/octicons/2.1.2/octicons.min.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2/3.5.0/select2-bootstrap.min.css" type="text/css">
        <link rel="stylesheet" href="{% static 'css/main.css' %}">
        <link rel="stylesheet" href="{% static 'css/plugins/smartadmin-production.css' %}" type="text/css" media="screen">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/3.1.3/css/bootstrap-datetimepicker.min.css" type="text/css" media="screen">
        <link rel="stylesheet" href="httpss://cdnjs.cloudflare.com/ajax/libs/blueimp-gallery/2.15.2/css/blueimp-gallery.min.css" type="text/css" media="screen">
        <link rel="stylesheet" href="{% static 'css/plugins/bootstrap-image-gallery.min.css' %}" type="text/css" media="screen">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ol3/3.2.0/ol.min.css" type="text/css">
        <link rel="stylesheet" href="{% static 'css/arches.css' %}">
        <link rel="stylesheet" href="{% static 'css/package.css' %}">
        <link rel="stylesheet" href="{% static 'css/main_cvast.css' %}"> 
        <link rel="stylesheet" href="{% static 'css/arches_cvast.css' %}">
    {% endblock css%}
</head>

<body class="scroll-y">
    <div class="wrapper">
    	{% block header %}
            {% include 'header.htm' %}
        {% endblock header %} 

		{% block breadcrumbs %}
        <!--=== Breadcrumbs ===-->
<!--         <div class="breadcrumbs">
            <div class="container">

                <h1 class="pull-left arches-breadcrumb-title">Reference Data Manager (RDM)</h1>
                <ul class="pull-right breadcrumb">
                    <li><a href="{% url 'home' %}">Home</a></li>
                    <li><a href="">Reference Data Manager</a></li>
                </ul>
            </div>
        </div> -->
        <!--=== End Breadcrumbs ===-->
        {% endblock breadcrumbs %}

        {% block subheader %}
        {% endblock subheader %}

        <!--=== Content Part ===-->
        {% block content %}
        {% endblock content %}
        <!--=== End Content Part ===-->

        <!--=== Footer ===-->
    	{% block footer %}
            {% include 'footer.htm' %}
        {% endblock footer %}
        <!--=== End Footer ===-->

        <!--=== Copyright ===-->
        {% block copyright %}
            {% include 'copyright.htm' %}
        {% endblock copyright %}
        <!--=== End Copyright ===-->

    </div><!--/wrapper-->

    {% block javascript %}
    <script src="{% static 'js/views/forms/config.js' %}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.14/require.min.js"></script>
    {% block pre_require_js %}
    {% endblock pre_require_js %}
    <script>
        require.config({
            baseUrl: '{{ STATIC_URL }}js',
            paths: {
                'plugins': '{{ STATIC_URL }}plugins',
                'async': 'https://cdnjs.cloudflare.com/ajax/libs/requirejs-async/0.1.1/async',
                'jquery': 'https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min',
                'select2': 'https://cdnjs.cloudflare.com/ajax/libs/select2/3.5.1/select2.min',
                'bootstrap': 'https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.1.0/js/bootstrap.min',
                'jquery-ui': 'https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.10.4/jquery-ui.min',
                'flexslider': 'https://cdnjs.cloudflare.com/ajax/libs/flexslider/2.2.2/jquery.flexslider-min',
                'openlayers': 'https://cdnjs.cloudflare.com/ajax/libs/ol3/3.2.0/ol.min',
                'easing': 'https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min',
                'backbone': 'https://cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min',
                'underscore': 'https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.7.0/underscore-min',
                'jquery-validate': 'https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.11.1/jquery.validate.min',
                'd3': 'https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.3/d3.min',
                'dropzone': 'https://cdnjs.cloudflare.com/ajax/libs/dropzone/3.8.4/dropzone-amd-module.min',
                'summernote': 'https://cdnjs.cloudflare.com/ajax/libs/summernote/0.5.10/summernote.min',
                'knockout': 'https://cdnjs.cloudflare.com/ajax/libs/knockout/3.3.0/knockout-min',
                //'knockout': 'https://knockoutjs.com/downloads/knockout-3.3.0.debug',
                'knockout-mapping': 'https://cdnjs.cloudflare.com/ajax/libs/knockout.mapping/2.4.1/knockout.mapping.min',
                'moment': 'https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.8.4/moment.min',
                'bootstrap-datetimepicker': 'https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/3.1.3/js/bootstrap-datetimepicker.min',
                'shp': 'httpss://raw.githubusercontent.com/wavded/js-shapefile-to-geojson/master/shapefile',
                'blueimp-gallery': 'httpss://cdnjs.cloudflare.com/ajax/libs/blueimp-gallery/2.15.2/js/blueimp-gallery',
                'blueimp-jquery': 'https://blueimp.github.io/Gallery/js/jquery.blueimp-gallery',
                'blueimp-helper': 'httpss://cdnjs.cloudflare.com/ajax/libs/blueimp-gallery/2.15.2/js/blueimp-helper.min'
            },
            shim: {
                'openlayers': {
                    exports: 'ol'
                }
            }
        });

        // application wide require calls
        require(["jquery"], function($) {
            var jQuery = $;

            // put values here that should be accessible application wide
            define('arches', [], function () {
                return {
                    urls: {
                        home: "{% url 'home' %}",
                        media: "{{ STATIC_URL }}",
                        uploadedfiles: "{{ MEDIA_URL }}",
                        concept_tree: "{% url 'concept_tree' %}",
                        concept: "{% url 'concept' 'aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa' %}",
                        concept_search: "{% url 'concept_search' %}",
                        concept_manage_parents: "{% url 'concept_manage_parents' 'aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa' %}",
                        from_sparql_endpoint: "{% url 'from_sparql_endpoint' 'aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa' %}",
                        search_sparql_endpoint: "{% url 'search_sparql_endpoint' %}",
                        confirm_delete: "{% url 'confirm_delete' 'aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa' %}",
                        edit_history: "{% url 'edit_history' 'aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa' %}",
                        search_terms: "{% url 'search_terms' %}",
                        search_results: "{% url 'search_results' %}",
                        search_results_export: "{% url 'search_results_export' %}",
                        map_layers: "{% url 'map_layers' '' %}",
                        map_markers: "{% url 'map_markers' '' %}",
                        reports: "{% url 'report' 'aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa' %}".replace('aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa', ''),
                        buffer: "{% url 'buffer'%}",
                        related_resources: "{% url 'related_resources' 'aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa' %}".replace('aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa', ''),
                        get_admin_areas: "{% url 'get_admin_areas'%}",
                    },
                    mapDefaults: {
                        x: {{ map_info.x }},
                        y: {{ map_info.y }},
                        zoom: {{ map_info.zoom }},
                        minZoom: {{ map_info.map_min_zoom }},
                        maxZoom: {{ map_info.map_max_zoom }},
                        extent: '{{ map_info.extent }}'
                    },
                    resourceMarker: {
                        font: '{{ map_info.resource_marker_font }}',
                        icon: '{{ map_info.resource_marker_icon }}',
                        defaultColor: '{{ map_info.resource_marker_color }}'
                    },
                    bingKey: "{{ map_info.bing_key }}",
                    bingLayers: [{
                        id: 'Road',
                        name: "{% trans 'Streets' %}",
                        icon: "{% static 'img/map/bing_streets.png' %}"
                    },
                    {
                        id: 'Aerial',
                        name: "{% trans 'Satellite' %}",
                        icon: "{% static 'img/map/bing_satellite.png' %}"
                    },
                    {
                        id: 'AerialWithLabels',
                        name: "{% trans 'Streets & Satellite' %}",
                        icon: "{% static 'img/map/bing_hybrid.png' %}"
                    }]
                };
            });

            define('resource-types', [], function () {
                var resourceTypes = {
                    {% for type, type_data in resource_types %}
                    "{{type}}": {
                        id: "{{type_data.resourcetypeid}}",
                        icon: "{{type_data.icon_class}}",
                        name: "{{type_data.name}}",
                        defaultDescription: "{{type_data.default_description}}",
                        descriptionNode: "{{type_data.description_node}}",
                        categories: [
                            {% for category in type_data.categories %}
                            "{{category}}"
                            {% endfor %}
                        ],
                        color: "{{type_data.marker_color}}",
                        strokeColor: "{{type_data.stroke_color}}",
                        fillColor: "{{type_data.fill_color}}"
                    },
                    {% endfor %}
                };

                return resourceTypes;;
            });

            require(["plugins/scroll-to-top", "views/simple-search", "bootstrap", "jquery-ui"], function (scrollToTop, SimpleSearch) {
                var search = new SimpleSearch({ el: $('#simple-search')[0] });                
                var scrollableElement;
                {% if active_page == 'ResourceReport' %}
                    scrollableElement = $('#report-body'); 
                {% endif %}

                scrollToTop.init(scrollableElement);
                // include all base_page instances here that page scripts may need access to
                // NOTE: this module should only ever be required from within main page scripts
                define('base_page', [], function () {
                    return {
                        search: search,
                        scrollToTop: scrollToTop
                    };
                });

                {% if main_script %}
                    // main page script require
                    require(["{{ main_script }}"]);
                {% endif %}

                $('[data-toggle="popover"]').popover();
            });

            require(["plugins/isInViewport-2.4.2/isInViewport.min", "jquery"], function () {
                 $(document).ready(function() {
                    $(window).scroll(function () {
                        $('video').each(function () {
                            if ($(this).is(":in-viewport")) {
                                $(this)[0].play();
                            } else {
                                $(this)[0].pause();
                            }
                        })
                    });
                });
            });
        });
    </script>

	{% endblock javascript %}

    {% if GOOGLE_ANALYTICS_TRACKING_ID != None %}
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', '{{GOOGLE_ANALYTICS_TRACKING_ID}}', 'auto');
      ga('send', 'pageview');
    </script>
    {% endif %}
</body>

</html>